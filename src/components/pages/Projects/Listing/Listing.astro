---
import { getImage } from 'astro:assets';
import { findImage, getFeatureImage } from '~/utils/images';
import ProjectListing from './ProjectListing';
import ArrowNext from '~/icons/arrow-next-orange.svg';
import ArrowPrev from '~/icons/arrow-prev-orange.svg';
import Arrows from '~/components/common/Arrows.astro';
import { fetchPosts } from '~/utils/project';

const arrows = {
    next: await getImage({ src: ArrowNext, format: "svg" }),
    prev: await getImage({ src: ArrowPrev, format: "svg" })
};

const projects = await fetchPosts();

---
<section class="sc-projects__listing">
    <div class="projects__listing">
        <ProjectListing data={projects} arrowsIC={arrows} client:visible={{ rootMargin: "100% 0% 100% 0%" }}>
            <Arrows slot="arrows" />
        </ProjectListing>
    </div>
</section>

<style lang="scss" is:global>
    @use '~/assets/styles/mixins' as *;
    .sc-projects__listing {
        position: relative;
        z-index: 6;
    }
    .projects__listing {
        &-main {
            padding-top: 17.14vh;
            padding-bottom: 8.76vh;
            height: 100%;
            @include md {
                padding-top: calc(6.6rem + 4svh);
                padding-bottom: 5.2svh;
                grid-template-rows: auto auto 1fr auto auto;
            }
            @include sm {
                padding-top: calc(6rem + 3.28svh);
                grid-template-rows: auto 1fr auto auto auto;
            }
        }
    }
    .projects__sticky {
        position: relative;
        height: 100vh;
        @include md {
            height: 100svh;
            overflow: hidden;
        }
        > .container {
            z-index: 3;
            height: 100%;
            // pointer-events: none;
            @include md {
                pointer-events: auto;
            }
        }
    }
    .projects__navigation {
        z-index: 2;
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        @include md {
            display: none;
        }
        &-area {
            width: 100%;
            height: 50%;
        }
    }
    .projects__position {
        position: absolute;
        inset: 0 var(--container-padding);
        opacity: 0;
        visibility: hidden;
        // pointer-events: none;
        &-name {
            grid-column: 1/9;
            grid-row: 1/3;
            align-self: end;

            line-height: .835em !important;
            padding-bottom: 7.6vh;

            @include md {
                @include text(dis1);
                line-height: .835em;
                grid-column: 1/-1;
                padding-bottom: calc(30rem + 5.7svh);
            }
            @include sm {
                @include text(h1);
                line-height: .835em;
                padding-bottom: calc(28rem + 3.2svh);
                overflow-wrap: anywhere;
            }
            @include xs {
                padding-bottom: calc(24rem + 3.2svh);
            }
        }
        &-info {
            grid-row: 1/2;
            grid-column: 13/16;
            padding-top: 17.14vh;
            display: flex;
            flex-direction: column;
            gap: 7.4rem 0;
            &-label {
                margin-bottom: 1rem;
            }
            &-listing {
                height: calc(var(--fs-16) * 1.4 * var(--max-line));
                overflow: hidden;
            }
            @include md {
                display: none;
            }
        }
        &-year {
            grid-column: 13/14;
            grid-row: 2/3;
            // line-height: .9em;
            padding-bottom: 9.2vh;
            align-self: end;
            @include md {
                display: none;
            }
        }
    }
    .project {
        &-item-label {
            margin-bottom: 1rem;
            pointer-events: auto;
        }
        &__name {
            grid-column: 1/5;
            overflow-wrap: break-word;
            margin-top: -.12em;
            align-self: start;
            @include md {
                grid-column: 1/-1;
                grid-row: 1/2;
                padding-bottom: 6rem;
            }
            @include sm {
                grid-row: 3/4;
                margin-top: 4rem;
                padding-bottom: 0;
                max-width: 30.12rem;
                overflow-wrap: anywhere;
                margin-bottom: 3.2rem;
            }
            &-txt {
                justify-self: start;
                align-self: start;
                line-height: .835em;
                @include md {
                    @include text(h1);
                    line-height: .835em;
                }
                @include sm {
                    @include text(h2);
                    line-height: .835em;
                }
                &.active {
                    pointer-events: auto;
                }
            }
        }
        &__desc {
            grid-column: 1/4;
            align-self: end;
            max-width: 32rem;
            position: relative;
            @include md {
                padding-top: 4rem;
                grid-column: 5/10;
                max-width: 30rem;
            }
            @include sm {
                padding-top: 3.2rem;
                grid-column: 1/-1;
                margin-right: 6rem;
            }
            .line {
                display: none;
                @include sm {
                    display: block;
                    position: absolute;
                    top: 0;
                }
            }
            &-txt {
                justify-self: start;
                align-self: end;
                &.active {
                    pointer-events: auto;
                }
                @include sm {
                    align-self: start;
                }
            }
        }
        &__link {
            display: none;
            align-items: center;
            column-gap: .6rem;
            @include md {
                margin-top: 4.35svh;
                display: flex;
            }
            @include sm {
                margin-top: 4rem;
            }
        }
        &__info {
            position: relative;
            z-index: 6;
            // grid-column: 6/9;
            grid-column: 6/16;
            grid-row: 1/2;
            align-self: start;
            justify-self: start;

            @include md {
                grid-row: 3/4;
                grid-column: 1/5;
                padding-top: 8rem;
            }
            @include sm {
                display: none;
            }

            // display: flex;
            // width: 100%;
            // gap: 0 1.9rem;
            // margin-left: -1.9rem;
            &-empty {
                // flex: 0;
                // transition: flex .5s ease-in-out;
            }
            &-inner {
                display: flex;
                flex-direction: column;
                align-items: start;
                gap: 7.4rem 0;
                @include md {
                    gap: 3.2rem 0;
                }
                // margin-left: calc(var(--grid-gap) * -1);
            }
        }
        &__role,
        &__services,
        &__selling {
            display: flex;
            flex-direction: column;
            align-items: start;
            &-listing {
                align-self: start;
                justify-self: start;

                display: flex;
                flex-direction: column;
                align-items: start;
                height: calc(var(--fs-16) * 1.4 * var(--max-line));
                &.active {
                    p {
                        pointer-events: auto;
                    }
                }
            }
        }
        &__year {
            grid-column: 6/8;
            align-self: end;
            pointer-events: auto;
            display: flex;
            gap: 0 .5rem;
            line-height: .9em;
            overflow: hidden;
            .word {
                line-height: .5em;
            }
            &-current {
                display: flex;
                align-items: center;
            }
            @include md {
                grid-column: 1/5;
                grid-row: 4/5;
            }
            @include sm {
                grid-column: 1/-1;
                grid-row: 3/5;
                justify-self: end;
                margin-bottom: -.5rem;
                @include text(14);
            }
        }
        &__thumbnail {
            height: 100%;
            &-wrap {
                grid-column: 9/15;
                grid-row: 1/3;
                position: relative;
                overflow: hidden;
                @include md {
                    grid-column: 5/-1;
                    grid-row: 2/5;
                }
                @include sm {
                    grid-column: 1/-1;
                    grid-row: 1/3;
                    margin-right: 6rem;
                }
            }
            &-listing {
                height: 100%;
                display: grid;
            }
            &-img {
                --clipIn: 100%;
                --clipOut: 100%;
                --imgTrans: 0%;
                --imgDirection: -1;
                --imgScale: 1;

                position: relative;
                @include size(100%);
                clip-path: polygon(var(--clipIn) var(--clipIn), var(--clipOut) var(--clipIn), var(--clipOut) var(--clipOut), var(--clipIn) var(--clipOut));
                &.active {
                    pointer-events: auto;
                }
                &-wrap {
                    transform-origin: 25% 25%;
                    transform: scale(var(--imgScale));
                    @include size(100%);
                }
                &-inner {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    pointer-events: none;

                    @include size(100%);
                    img {
                        position: absolute;
                        object-fit: cover;
                        transform: translate(calc(var(--imgTrans) / (2 * var(--imgDirection))), calc(var(--imgTrans) / (2 * var(--imgDirection))));
                    }
                }
            }
        }
        &__pagination {
            grid-column: -2/-1;
            grid-row: 1/3;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            justify-self: end;

            @include md {
                grid-column: 1/5;
                grid-row: 2/3;
                justify-self: start;
            }
            @include sm {
                grid-column: 1/1/-1;
                grid-row: 1/2;
                justify-self: end;
            }
            &-main {
                display: flex;
                flex-direction: column;
                width: 6.6rem;
                @include md {
                    display: none;
                }
            }
            &-item {
                position: relative;
                display: flex;
                justify-content: center;
                align-items:  center;
                width: 100%;
                height: .2rem;
                transition: height .6s ease-in-out;

                &:before, &:after {
                    top: 0;
                    height: .2rem;
                    z-index: 3;
                }
                &:after {
                    top: 0;
                    height: .2rem;
                    background-color: #C4C4C4;
                }
                &-wrap {
                    padding-block: 1rem;
                    cursor: pointer;
                    overflow: hidden;
                    opacity: .2;
                    transition: opacity .6s ease-in-out;
                    &.active {
                        opacity: 1;
                        pointer-events: none;
                        .project__pagination-item {
                            height: 9.4rem;
                            &:after {
                                transform: translateX(var(--line-spacing));
                            }
                            // opacity: 1;
                        }
                        .project__pagination-item-progress-bg {
                            opacity: 1;
                        }
                        .project__pagination-item-img {
                            img {
                                transform: scale(1);
                            }
                        }
                    }
                    &:hover {
                        opacity: 1;
                        .project__pagination-item {
                            &:before {
                                transform: translateX(calc(100% + var(--line-spacing)));
                            }
                            &:after {
                                transform: translateX(var(--line-spacing));
                            }
                        }
                    }
                }
                &-img {
                    position: absolute;
                    z-index: 3;
                    @include size(calc(100% - 1rem));
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow: hidden;
                    img {
                        position: absolute;
                        height: 9.4rem !important;
                        transition: transform .4s linear;
                    }
                }
                &-progress {
                    z-index: 2;
                    position: absolute;
                    inset: 0;
                    overflow: hidden;
                    // opacity: 0;
                    &-bg {
                        position: absolute;
                        z-index: 2;
                        inset: 0;
                        opacity: .1;
                        border: .2rem solid transparent;
                        background: #C4C4C4 border-box;
                        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                        mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                        mask-composite: exclude;
                        transition: opacity .4s linear;
                    }
                }
            }
            &-wrap {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding-bottom: 2rem;
            }
            .line {
                position: absolute;
                bottom: 0;
            }
            &-number {
                position: relative;
                display: flex;
                align-items: center;
                gap: 0 .8rem;
                line-height: .9em;

                .word {
                    line-height: .5em;
                }
                @include md {
                    @include text(18);
                    line-height: 1em;
                }
                @include sm {
                    @include text(14);
                    gap: 0 .2rem;
                    line-height: 1em;
                }
                &-current {
                    display: flex;
                    align-items: center;
                }
            }
        }
        &__control {
            display: none;

            @include md {
                display: flex;
                align-items: end;
                justify-self: end;
                gap: 0 .8rem;
                grid-area: 1/1/2/-1;
                padding-bottom: 6rem;
            }
            @include sm {
                padding-bottom: 0;
                grid-row: 2/3;
                margin: -.3rem;
            }
            &-arrow {
                @include size(4.4rem);
                border-radius: 50%;
                border: 1px solid var(--cl-dm-border);
                display: flex;
                justify-content: center;
                align-items: center;
                @include sm {
                    @include size(2.2rem);
                    border: none;
                }
            }
        }
    }
</style>