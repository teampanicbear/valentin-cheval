---
import type { ImageMetadata } from 'astro';
import type { MetaData } from '~/types';

import merge from 'lodash.merge';
import { findImage } from '~/utils/images';
import { getStaticPathsProjectPost } from '~/utils/project';

import Layout from '~/layouts/PageLayout.astro';
import SinglePost from '~/components/pages/Projects/Post/SinglePost.astro';
import { mdxComponents } from '~/components/pages/Projects/MDX/mdxComponents';
import NextPost from '~/components/pages/Projects/Post/Next/NextPost.astro';

export const getStaticPaths = (async () => {
    return await getStaticPathsProjectPost();
});

const { post } = Astro.props;
// const image = (await findImage(post.image)) as ImageMetadata | undefined;
const metadata = merge(
    {
        title: post.title,
        description: post.excerpt,
        robots: {
            // index: blogPostRobots?.index,
            // follow: blogPostRobots?.follow,
        },
        openGraph: {
        type: 'article',
        ...(post.image
            ? { images: [{ url: post.image, width: (post.image as ImageMetadata)?.width, height: (post.image as ImageMetadata)?.height }] }
            : {}),
        },
    },
    { ...(post?.metadata ? { ...post.metadata, canonical: post.metadata?.canonical } : {}) }
    ) as MetaData;
---
<<<<<<< HEAD
<Layout metadata={metadata} post={post} namespace='project'>
    <SinglePost post={{ ...post, image: image }}>
=======
<Layout metadata={metadata} post={post}>
    <SinglePost post={{ ...post }}>
>>>>>>> d53f1e9 (Update CMS Server)
        {post.Content ?  <post.Content /> : <Fragment set:html={post.content || ''} />}
    </SinglePost>
    <NextPost post={post}/>
</Layout>